<HTML>
<HEAD>
   <TITLE> module s2_proj_mod (generated by f90doc) </TITLE>
  <LINK rel="stylesheet" href="stylesheet.css" type="text/css" /> </HEAD>
<H1> Module s2_proj_mod </H1>
<PRE>module s2_proj_mod

        ! Uses
    use <A HREF="s2_types_mod.html">s2_types_mod</A>, only: s2_sp, s2_spc, s2_dp, s2_dpc, pi
    use <A HREF="s2_error_mod.html">s2_error_mod</A>
    use <A HREF="s2_sky_mod.html">s2_sky_mod</A>

        ! Types
    public type <A HREF="s2_proj_mod.html#type_s2_proj">s2_proj</A>

        ! Variables
    integer, public, parameter :: <A HREF="s2_proj_mod.html#var_s2_proj_method_none">S2_PROJ_METHOD_NONE</A> = 0
    integer, public, parameter :: <A HREF="s2_proj_mod.html#var_s2_proj_method_nearest_neighbour">S2_PROJ_METHOD_NEAREST_NEIGHBOUR</A> = 1
    integer, public, parameter :: <A HREF="s2_proj_mod.html#var_s2_proj_method_harmonic_interp">S2_PROJ_METHOD_HARMONIC_INTERP</A> = 2
    integer, public, parameter :: <A HREF="s2_proj_mod.html#var_s2_proj_method_kernel">S2_PROJ_METHOD_KERNEL</A> = 3
    integer, public, parameter :: <A HREF="s2_proj_mod.html#var_s2_proj_field_hemisphere_upper">S2_PROJ_FIELD_HEMISPHERE_UPPER</A> = 0
    integer, public, parameter :: <A HREF="s2_proj_mod.html#var_s2_proj_field_hemisphere_lower">S2_PROJ_FIELD_HEMISPHERE_LOWER</A> = 1

        ! Subroutines and functions
    public function <A HREF="s2_proj_mod.html#function_s2_proj_init">s2_proj_init</A> (sky, theta_fov, method, field, nside, lmax) result (proj)
    public subroutine <A HREF="s2_proj_mod.html#subroutine_s2_proj_free">s2_proj_free</A> (proj)
    private subroutine <A HREF="s2_proj_mod.html#subroutine_s2_proj_compute_params">s2_proj_compute_params</A> (theta_fov, lmax, N, dx, umax, image_size)
    private subroutine <A HREF="s2_proj_mod.html#subroutine_s2_proj_projection_nearest_neighbour">s2_proj_projection_nearest_neighbour</A> (sky, proj, nside)
    public subroutine <A HREF="s2_proj_mod.html#subroutine_s2_proj_operator_nearest_neighbour">s2_proj_operator_nearest_neighbour</A> (proj, nside, nop, op, nsphere, xmap)
    private subroutine <A HREF="s2_proj_mod.html#subroutine_s2_proj_projection_kernel">s2_proj_projection_kernel</A> (sky, proj, nside)
    public subroutine <A HREF="s2_proj_mod.html#subroutine_s2_proj_operator_kernel">s2_proj_operator_kernel</A> (proj, nside, nop, op, nsphere, xmap)
    private subroutine <A HREF="s2_proj_mod.html#subroutine_s2_proj_projection_harmonic_interp">s2_proj_projection_harmonic_interp</A> (sky, proj, lmax)
    public subroutine <A HREF="s2_proj_mod.html#subroutine_s2_proj_get_xmap">s2_proj_get_xmap</A> (proj, nside, nsphere, xmap, thetas, phis)
    public subroutine <A HREF="s2_proj_mod.html#subroutine_s2_proj_write_image_file">s2_proj_write_image_file</A> (proj, filename, comment)

end module s2_proj_mod
</PRE>
 Provides functionality to project a sky object onto a planar image.
<P>
<STRONG>Author:</STRONG> J. D. McEwen (mcewen@mrao.cam.ac.uk)

<HR><H2> Description of Types </H2>
<A NAME="type_s2_proj"><H3>s2_proj</H3></A>
<PRE>public type s2_proj
    private
    logical :: init = .false.
    type (s2_sky) :: parent
    real (kind=s2_sp) :: theta_fov = 0e0
    integer :: N = 0
    real (kind=s2_sp) :: dx = 0e0
    real (kind=s2_sp) :: umax = 0e0
    real (kind=s2_sp) :: image_size = 0e0
    integer :: method = S2_PROJ_METHOD_NONE
    integer :: field = S2_PROJ_FIELD_HEMISPHERE_UPPER
    real (kind=s2_sp), allocatable, dimension (:,:) :: image
end type s2_proj
</PRE>

<HR><H2> Description of Variables </H2>
<A NAME="var_s2_proj_method_none"><H3>S2_PROJ_METHOD_NONE</H3></A>
<PRE>integer, public, parameter :: S2_PROJ_METHOD_NONE = 0
</PRE>
 No projection method.
<A NAME="var_s2_proj_method_nearest_neighbour"><H3>S2_PROJ_METHOD_NEAREST_NEIGHBOUR</H3></A>
<PRE>integer, public, parameter :: S2_PROJ_METHOD_NEAREST_NEIGHBOUR = 1
</PRE>
 Project using nearest neighbour method.
<A NAME="var_s2_proj_method_harmonic_interp"><H3>S2_PROJ_METHOD_HARMONIC_INTERP</H3></A>
<PRE>integer, public, parameter :: S2_PROJ_METHOD_HARMONIC_INTERP = 2
</PRE>
 Project using harmonic interpolation method.
<A NAME="var_s2_proj_method_kernel"><H3>S2_PROJ_METHOD_KERNEL</H3></A>
<PRE>integer, public, parameter :: S2_PROJ_METHOD_KERNEL = 3
</PRE>
 Project using convolution kernel interpolation method.
<A NAME="var_s2_proj_field_hemisphere_upper"><H3>S2_PROJ_FIELD_HEMISPHERE_UPPER</H3></A>
<PRE>integer, public, parameter :: S2_PROJ_FIELD_HEMISPHERE_UPPER = 0
</PRE>
 Project upper hemisphere to plane.
<A NAME="var_s2_proj_field_hemisphere_lower"><H3>S2_PROJ_FIELD_HEMISPHERE_LOWER</H3></A>
<PRE>integer, public, parameter :: S2_PROJ_FIELD_HEMISPHERE_LOWER = 1
</PRE>
 Project lower hemisphere to plane.

<HR><H2> Description of Subroutines and Functions </H2>
<A NAME="function_s2_proj_init"><H3>s2_proj_init</H3></A>
<PRE>public function s2_proj_init (sky, theta_fov, method, field, nside, lmax) result (proj)
    type (s2_sky), intent(inout) :: sky
    real (kind=s2_sp), intent(in) :: theta_fov
    integer, intent(in) :: method
    integer, optional, intent(in) :: field
    integer, optional, intent(in) :: nside
    integer, optional, intent(in) :: lmax
    type (s2_proj) :: proj
    ! Calls: s2_error, s2_proj_compute_params, s2_proj_projection_harmonic_interp, s2_proj_projection_kernel, s2_proj_projection_nearest_neighbour
end function s2_proj_init
</PRE>
 Initialie a proj object from a sky.
<P>
 Variables:
   <UL>
   <LI>  sky: Sky to project onto planar image.
   <LI>  theta_fov: Theta field of view.
   <LI>  method: Method to use to project sky onto planar image.
   <LI>  field: Hemisphere to project onto plane.
   <LI>  [nside]: Healpix nside (required by some projection methods if not 
     provided in sky object).
   <LI>  [lmax]: Alm lmax (required by some projection methods if not 
     provided in sky object).
   <LI>  proj: The returned sky initialised with resolutions and projected 
     planar image.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<A NAME="subroutine_s2_proj_free"><H3>s2_proj_free</H3></A>
<PRE>public subroutine s2_proj_free (proj)
    type (s2_proj), intent(inout) :: proj
    ! Calls: s2_error
end subroutine s2_proj_free
</PRE>
 Free all data associated with an initialised proj object and reset all
 other attributes.
<P>
 Variables:
   <UL>
   <LI>  proj: The proj object to be freed.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<A NAME="subroutine_s2_proj_compute_params"><H3>s2_proj_compute_params</H3></A>
<PRE>private subroutine s2_proj_compute_params (theta_fov, lmax, N, dx, umax, image_size)
    real (kind=s2_sp), intent(in) :: theta_fov
    integer, intent(in) :: lmax
    integer, intent(out) :: N
    real (kind=s2_sp), intent(out) :: dx
    real (kind=s2_sp), intent(out) :: umax
    real (kind=s2_sp), intent(out) :: image_size
    ! Calls: s2_error
end subroutine s2_proj_compute_params
</PRE>
 Compute size parameters of planar image from field of view and harmonic
 band-limit.
<P>
 Variables:
   <UL>
   <LI>  theta_fov: Input theta field of view.
   <LI>  lmax: Input harmonic band-limit.
   <LI>  N: Computed number of pixels in each dimension of square image.
   <LI>  dx: Computed spacing between pixels in image.
   <LI>  umax: Computed band-limit in plane.
   <LI>  image_size: Compute size of image.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<A NAME="subroutine_s2_proj_projection_nearest_neighbour"><H3>s2_proj_projection_nearest_neighbour</H3></A>
<PRE>private subroutine s2_proj_projection_nearest_neighbour (sky, proj, nside)
    type (s2_sky), intent(inout) :: sky
    type (s2_proj), intent(inout) :: proj
    integer, optional, intent(in) :: nside
    ! Calls: ang2pix_nest, ang2pix_ring, s2_error, s2_sky_compute_map, s2_vect_convert, s2_vect_free
end subroutine s2_proj_projection_nearest_neighbour
</PRE>
 Project sky to planar image using nearest neighbour method.
<P>
 Notes:
   <UL>
   <LI>  Space to store image must be allocated before calling this routine.
<P>
   </UL>
 Variables:
   <UL>
   <LI>  sky: Sky to project to planar image.
   <LI>  proj: Projected sky.
   <LI>  [nside]: Optional Healpix nside to consider in map of sky when 
     projecting image (if not provided taken from sky).
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<A NAME="subroutine_s2_proj_operator_nearest_neighbour"><H3>s2_proj_operator_nearest_neighbour</H3></A>
<PRE>public subroutine s2_proj_operator_nearest_neighbour (proj, nside, nop, op, nsphere, xmap)
    type (s2_proj), intent(inout) :: proj
    integer, optional, intent(in) :: nside
    integer, intent(out) :: nop
    integer, allocatable, intent(out), dimension (:,:) :: op
    integer, intent(out) :: nsphere
    real (kind=s2_sp), allocatable, intent(out), dimension (:) :: xmap
    ! Calls: ang2pix_nest, ang2pix_ring, pix2ang_ring, s2_error, s2_sky_compute_map, s2_sky_get_map, s2_sky_map_convert, s2_vect_convert, s2_vect_free
end subroutine s2_proj_operator_nearest_neighbour
</PRE>
 Compute sparse representaion of linear operation to perform nearest 
 neighbour projection.  The map vector containing the pixels on the 
 sphere within the fov is also returned.
<P>
 Notes:
   <UL>
   <LI>  Space for op and xmap allocate herein; must be freed by calling 
     routine.
<P>
   </UL>
 Variables:
   <UL>
   <LI>  proj: Projected sky.
   <LI>  [nside]: Optional Healpix nside to consider in map of sky when 
     projecting image (if not provided taken from sky).
   <LI>  nop: Number of non-zero enties in the projection operator.
   <LI>  op(0:nop-1,0:1): Projection operator (specifies indices of
     unit entries in operator matrix).
   <LI>  nsphere: Number of pixels on the sphere within the fov.
   <LI>  xmap(0:nsphere-1): Vector of pixels values on the sphere within 
     the fov.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<A NAME="subroutine_s2_proj_projection_kernel"><H3>s2_proj_projection_kernel</H3></A>
<PRE>private subroutine s2_proj_projection_kernel (sky, proj, nside)
    type (s2_sky), intent(inout) :: sky
    type (s2_proj), intent(inout) :: proj
    integer, optional, intent(in) :: nside
    ! Calls: s2_error, s2_sky_compute_map, s2_vect_convert, s2_vect_free
end subroutine s2_proj_projection_kernel
</PRE>
 Project sky to planar image using convolution kernel projection method.
<P>
 Notes:
   <UL>
   <LI>  Space to store image must be allocated before calling this routine.
<P>
   </UL>
 Variables:
   <UL>
   <LI>  sky: Sky to project to planar image.
   <LI>  proj: Projected sky.
   <LI>  [nside]: Optional Healpix nside to consider in map of sky when 
     projecting image (if not provided taken from sky).
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<A NAME="subroutine_s2_proj_operator_kernel"><H3>s2_proj_operator_kernel</H3></A>
<PRE>public subroutine s2_proj_operator_kernel (proj, nside, nop, op, nsphere, xmap)
    type (s2_proj), intent(inout) :: proj
    integer, optional, intent(in) :: nside
    integer, intent(out) :: nop
    real (kind=s2_dp), allocatable, intent(out), dimension (:,:) :: op
    integer, intent(out) :: nsphere
    real (kind=s2_sp), allocatable, intent(out), dimension (:) :: xmap
    ! Calls: pix2ang_ring, s2_error, s2_sky_compute_map, s2_sky_convpt_space_weights, s2_sky_get_map, s2_sky_map_convert, s2_vect_convert, s2_vect_free
end subroutine s2_proj_operator_kernel
</PRE>
 Compute sparse representaion of linear operation to perform convolution  
 kernel projection.  The map vector containing the pixels on the 
 sphere within the fov is also returned.
<P>
 Notes:
   <UL>
   <LI>  Space for op and xmap allocate herein; must be freed by calling 
     routine.
<P>
   </UL>
 Variables:
   <UL>
   <LI>  proj: Projected sky.
   <LI>  [nside]: Optional Healpix nside to consider in map of sky when 
     projecting image (if not provided taken from sky).
   <LI>  nop: Number of non-zero enties in the projection operator.
   <LI>  op(0:nop-1,0:2): Projection operator (specifies indices and values 
     of entries in operator matrix).
   <LI>  nsphere: Number of pixels on the sphere within the fov.
   <LI>  xmap(0:nsphere-1): Vector of pixels values on the sphere within 
     the fov.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<A NAME="subroutine_s2_proj_projection_harmonic_interp"><H3>s2_proj_projection_harmonic_interp</H3></A>
<PRE>private subroutine s2_proj_projection_harmonic_interp (sky, proj, lmax)
    type (s2_sky), intent(inout) :: sky
    type (s2_proj), intent(inout) :: proj
    integer, optional, intent(in) :: lmax
    ! Calls: s2_error, s2_sky_compute_alm, s2_sky_irregular_invsht, s2_vect_convert, s2_vect_free
end subroutine s2_proj_projection_harmonic_interp
</PRE>
 Project sky to planar image using harmonic interpolation method.
<P>
 Notes:
   <UL>
   <LI>  Space to store image must be allocated before calling this routine.
   <LI>  The associate Legendre functions computed using Numerical Recipes
     routines appear to be stable to lmax~128 (otherwise return NaN), 
     while using Wigner dlmn matrices is relatively slow, but can run 
     at very high band-limits.  The current impleentation is based on 
     Wigner dlmn matrices.
<P>
   </UL>
 Variables:
   <UL>
   <LI>  sky: Sky to project to planar image.
   <LI>  proj: Projected sky.
   <LI>  [lmax]: Optional harmonic band-limit lmax to consider in harmonic
     representation of sky when projecting image (if not provided taken 
     from sky).
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<A NAME="subroutine_s2_proj_get_xmap"><H3>s2_proj_get_xmap</H3></A>
<PRE>public subroutine s2_proj_get_xmap (proj, nside, nsphere, xmap, thetas, phis)
    type (s2_proj), intent(inout) :: proj
    integer, optional, intent(in) :: nside
    integer, intent(out) :: nsphere
    real (kind=s2_sp), allocatable, intent(out), dimension (:) :: xmap
    real (kind=s2_dp), allocatable, intent(out), dimension (:) :: thetas
    real (kind=s2_dp), allocatable, intent(out), dimension (:) :: phis
    ! Calls: pix2ang_ring, s2_error, s2_sky_compute_map, s2_sky_get_map, s2_sky_map_convert
end subroutine s2_proj_get_xmap
</PRE>
 Compute xmap, theta and phi arrays for spherical cap within FOV.
<P>
 Notes:
   <UL>
   <LI>  Space for xmap, thetas and phis allocate herein; must be freed by  
     calling routine.
<P>
   </UL>
 Variables:
   <UL>
   <LI>  proj: Projected sky.
   <LI>  [nside]: Optional Healpix nside to consider in map of sky when 
     projecting image (if not provided taken from sky).
   <LI>  nsphere: Number of pixels on the sphere within the fov.
   <LI>  xmap(0:nsphere-1): Vector of pixels values on the sphere within 
     the fov.
   <LI>  thetas(0:nsphere-1): Vector of theta positions on the sphere within 
     the fov.
   <LI>  phis(0:nsphere-1): Vector of phi positions on the sphere within 
     the fov.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<A NAME="subroutine_s2_proj_write_image_file"><H3>s2_proj_write_image_file</H3></A>
<PRE>public subroutine s2_proj_write_image_file (proj, filename, comment)
    type (s2_proj), intent(in) :: proj
    character (len=*), intent(in) :: filename
    character (len=*), optional, intent(in) :: comment
    ! Calls: s2_error
end subroutine s2_proj_write_image_file
</PRE>
 Write a projected image to a file. 
<P>
 Variables:
   <UL>
   <LI>  proj: Projected sky.
   <LI>  filename: Name of the output file.
   <LI>  [comment]: Optional additional comment to be added to the file
     header.
   </UL>
<P>
<STRONG>Author:</STRONG> J. D. McEwen
<P>
<STRONG>Version:</STRONG> Under svn version control.
</HTML>
